<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>jv-datepicker demo</title>
  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../paper-styles/paper-styles.html">
  <link rel="import" href="../../paper-styles/demo-pages.html">
  <link rel="import" href="../../iron-media-query/iron-media-query.html">
  <link rel="import" href="../../paper-radio-group/paper-radio-group.html">
  <link rel="import" href="../../paper-radio-button/paper-radio-button.html">
  <link rel="import" href="../../paper-checkbox/paper-checkbox.html">
  <link rel="import" href="../../paper-toggle-button/paper-toggle-button.html">
  <link rel="import" href="../../neon-animation/animations/scale-up-animation.html">
  <link rel="import" href="../../neon-animation/animations/fade-out-animation.html">

  <link rel="import" href="../jv-datepicker.html">
  <link rel="import" href="../jv-datepicker-dialog.html">
  <style is="custom-style">
    :root {
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }

    *, *::before, *::after {
      box-sizing: inherit;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
    }

    .horizontal-section {
      min-width: 130px;
    }

    paper-button:hover {
      @apply(--shadow-elevation-3dp);
    }

    paper-button {
      display: block;
      margin-bottom: 24px;
    }

    paper-radio-button, paper-checkbox {
      display: block;
      width: 130px;
    }

    div paper-checkbox {
      margin-top: 12px;
      margin-bottom: 20px;
    }

    hr {
      margin-bottom: 40px;
      border-color: var(--divider-color, #e0e0e0);
    }

    .display-date {
      text-align: justify;
      padding-bottom: 20px;
    }

    .display-date > span {
      font-style: oblique;
      font-weight: bolder;
      color: var(--dark-primary-color, #303f9f);
    }

    .pick-date {
      margin: 20px 0;
    }

    .wrap-datepicker {
      overflow: auto;
      width: 96%;
      min-width: 300px;
      max-width: 96%;
    }

    .datepicker-boilerplate {
      width: 90%;
      border: 1px solid #cfd8dc;
      color: #607d8b;
      display: block;
      height: 36px;
      -webkit-flex-shrink: 0;
      flex-shrink: 0;
      padding: 10px 4px;
      margin: 0 13px 12px;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
      border-radius: 2px;
      font-size: 12px;
    }

    jv-datepicker {
      @apply(--shadow-elevation-6dp);
    }

    .code-section div {
      margin: 20px 0;
    }

    .note {
      font-size: 10px;
      font-style: italic;
      color: #727272;
    }

    .normal {
      width: initial;
    }

    /* mixin */
    jv-datepicker-dialog#colorDialog {
      /*--jv-datepicker {}*/
      --jv-datepicker-button-color: #80CBC4;
      --jv-datepicker-button-ink-color: #80CBC4;
      --jv-datepicker-icon-button-color: #ffff00;
      --jv-datepicker-icon-button-ink-color: #ffff00;
      --jv-datepicker-selected-day-bg: #80CBC4;
      --jv-datepicker-selected-day-color: #555555;
      --jv-datepicker-today-color: #80CBC4;
      --jv-datepicker-disabled-color: #ffff00;
      --jv-datepicker-selection-color: #ffffff;
      --jv-datepicker-selection-bg: #555555;
      --jv-datepicker-weekday-bg: #555555;
      --jv-datepicker-bg: #424242;
      --jv-datepicker-calendar-text-color: #ffffff;
      --jv-datepicker-calendar-bg: #424242;
      --jv-datepicker-selection-ripple-color: #ffff00;
      --jv-datepicker-weekdays-color: #c6c6c6;
    }
  </style>
</head>
<body unresolved>
<template is="dom-bind" id="app">
  <iron-media-query query="(orientation: portrait)" query-matches="{{portrait}}">
  </iron-media-query>
  <div class="horizontal-section-container">
    <div>
      <h4>Simple Styled</h4>
      <section class="horizontal-section">
        <paper-button tab-index="0" id="regular" data-dialog="regularDialog" on-tap="_openDatepicker">light theme</paper-button>
        <paper-button tab-index="0" id="color" data-dialog="colorDialog" on-tap="_openDatepicker">dark theme</paper-button>
        <paper-button tab-index="0" id="backdrop" data-dialog="backdropDialog" on-tap="_openDatepicker">with-backdrop</paper-button>
        <paper-button tab-index="0" id="simple" data-dialog="simpleDialog" on-tap="_openDatepicker">Simple</paper-button>
        <paper-button tab-index="0" id="reset" data-dialog="resetDialog" on-tap="_openDatepicker">reset date</paper-button></paper-button>
      </section>
    </div>

    <div>
      <h4>First Day of Week</h4>
      <section class="horizontal-section">
        <paper-radio-group id="start" selected="{{firstDayOfWeek}}">
          <paper-radio-button name="0" label="sunday">sunday</paper-radio-button>
          <paper-radio-button name="1" label="monday">monday</paper-radio-button>
          <paper-radio-button name="2" label="tuesday">tuesday</paper-radio-button>
          <paper-radio-button name="3" label="wednesday">wednesday</paper-radio-button>
          <paper-radio-button name="4" label="thursday">thursday</paper-radio-button>
          <paper-radio-button name="5" label="friday">friday</paper-radio-button>
          <paper-radio-button name="6" label="saturday">saturday</paper-radio-button>
        </paper-radio-group>
        <hr>
        <paper-button tab-index="0" id="start" data-dialog="startDialog" on-click="_openDatepicker">{{dayStart}}</paper-button>
      </section>
    </div>

    <div>
      <h4>Disable Day (s)</h4>
      <section class="horizontal-section">
        <div on-tap="checkboxHandler">
          <paper-checkbox checked="{{sun}}">sunday</paper-checkbox>
          <paper-checkbox checked="{{mon}}">monday</paper-checkbox>
          <paper-checkbox checked="{{tue}}">tuesday</paper-checkbox>
          <paper-checkbox checked="{{wed}}">wednesday</paper-checkbox>
          <paper-checkbox checked="{{thu}}">thursday</paper-checkbox>
          <paper-checkbox checked="{{fri}}">friday</paper-checkbox>
          <paper-checkbox checked="{{sat}}">saturday</paper-checkbox>
        </div>
        <hr>
        <paper-button tab-index="0" id="multidays" data-dialog="disableDialog" on-click="_openDatepicker">show selected</paper-button>
        <paper-button tab-index="0" id="weekends" data-dialog="weekendsDialog" on-click="_openDatepicker">weekends</paper-button>
      </section>
    </div>

    <div>
      <h4>Date Format Options</h4>
        <section class="horizontal-section">
          <div>
            <h4>Year</h4>
            <paper-radio-group id="year" selected="{{yearFormat}}">
              <paper-radio-button name="yyyy" label="yyyy">yyyy</paper-radio-button>
              <paper-radio-button name="yy" label="yy">yy</paper-radio-button>
            </paper-radio-group>
            <hr>
            <h4>Month</h4>
            <paper-radio-group id="month" selected="{{monthFormat}}">
              <paper-radio-button name="mmmm" label="mmmm">mmmm</paper-radio-button>
              <paper-radio-button name="mmm" label="mmm">mmm</paper-radio-button>
              <paper-radio-button name="mm" label="mm">mm</paper-radio-button>
              <paper-radio-button name="m" label="m">m</paper-radio-button>
            </paper-radio-group>
            <hr>
            <h4>Day</h4>
            <paper-radio-group id="day" selected="{{dayFormat}}">
              <paper-radio-button name="do" label="do">do</paper-radio-button>
              <paper-radio-button name="dd" label="dd">dd</paper-radio-button>
              <paper-radio-button name="d" label="d">d</paper-radio-button>
            </paper-radio-group>
            <hr>
            <div class="display-date">
              bind-date: <span>{{displayBind}}</span>
            </div>
            <div class="display-date">
              fire-date: <span>{{displayDate}}</span>
            </div>
            <paper-button tab-index="0" id="dayFormat" data-dialog="formatDialog" on-click="_openDatepicker">choose date</paper-button>
          </div>
        </section>
      </div>
    </div>

    <div>
      <h4>Datepicker w/o dialog</h4>
      <section class="horizontal-section wrap-datepicker">
        <jv-datepicker id="normalDatepicker" portrait="{{portrait}}" bind-date="{{normalSelected}}"></jv-datepicker>
        <div class="pick-date">Selected Date (Press OK after selecting a date):</div>
        <div class="display-date">
          <span>{{normalSelected}}</span>
        </div>
      </section>
    </div>

    <div>
      <h4>Element's Boilerplate</h4>
      <section class="horizontal-section code-section" on-iron-change="genCode">
        <div>
          <paper-toggle-button data-toggle="dialog" checked="{{takeDialog}}"></paper-toggle-button>
          <span>{{takeElement}}<span class="note">&emsp;//Note: Toggle between non-dialog and dialog element.</span></span>
        </div>
        <div>
          <paper-checkbox data-toggle="modal" checked="{{takeModal}}" disabled="{{takeBackdrop}}">
            <span>modal</span>
          </paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="backdrop" checked="{{takeBackdrop}}" disabled="{{takeModal}}">
            <span>withBackdrop</span>
          </paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="start" checked="{{takefirstDayOfWeek}}">
            <span>firstDayOfWeek</span>
          </paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="disable" checked="{{takeDisableDays}}">
            <span>disableDays</span>
          </paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="format" checked="{{takeFormat}}">
            <span>dateFormat</span>
          </paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="bind" checked="{{takeBindDate}}">
            <span>bindDate</span>
          </paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="fire" checked="{{takeFormatDate}}">
            <span>onFormatDate</span>
          </paper-checkbox>
        </div>
        <div>
          <paper-checkbox class="normal" data-toggle="reset" checked="{{takeReset}}">
            <span>resetDate<span class="note">&emsp;//Note: Check if you want to reset the calendar to current month and year.</span></span>
          </paper-checkbox>
        </div>
        <input class="datepicker-boilerplate" value="{{dateCode}}" title="jv-datepicker-boilerplate" readonly onclick="this.select();">
      </section>
    </div>

    <section>
      <jv-datepicker-dialog id="resetDialog" entry-animation="scale-up-animation"  exit-animation="fade-out-animation"
      first-day-of-week="0" disable-days="[0,6]" reset-date></jv-datepicker-dialog>
      <jv-datepicker-dialog id="simpleDialog" entry-animation="scale-up-animation"  exit-animation="fade-out-animation"
      first-day-of-week="0" disable-days="[0,6]"></jv-datepicker-dialog>
      <jv-datepicker-dialog id="backdropDialog" entry-animation="scale-up-animation" with-backdrop  exit-animation="fade-out-animation"
      first-day-of-week="0" disable-days="[0,6]"></jv-datepicker-dialog>
      <jv-datepicker-dialog id="colorDialog" entry-animation="scale-up-animation" modal  exit-animation="fade-out-animation"
      first-day-of-week="0" disable-days="[0,6]"></jv-datepicker-dialog>
      <jv-datepicker-dialog id="regularDialog" entry-animation="scale-up-animation" modal  exit-animation="fade-out-animation"
      first-day-of-week="0" disable-days="[0,6]"></jv-datepicker-dialog>
      <jv-datepicker-dialog id="startDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" modal
      first-day-of-week="{{firstDayOfWeek}}" disable-days="[0,6]"></jv-datepicker-dialog>
      <jv-datepicker-dialog id="disableDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" modal
      first-day-of-week="0" disable-days="{{disableDays}}"></jv-datepicker-dialog>
      <jv-datepicker-dialog id="weekendsDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" modal
      first-day-of-week="0" disable-days="[0, 6]"></jv-datepicker-dialog>
      <jv-datepicker-dialog id="formatDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" modal date-format="{{format}}" bind-date="{{displayBind}}" on-format-date="_formatDate"></jv-datepicker-dialog>
    </section>
  </div>
</template>
<script>
  var app = document.querySelector('#app');
  app.firstDayOfWeek = 0;
  app.disableDays = [];
  app.dateFormat = 'yyyy-mm-dd';
  app.dayStart = 'sunday';
  app.yearFormat = 'yyyy';
  app.monthFormat = 'mm';
  app.dayFormat = 'dd';
  app.displayDate = initializeDate();
  app.displayBind = initializeDate();
  app.dateOrientation = 'portrait';

  app.dateCode = '<jv-datepicker-dialog modal></jv-datepicker-dialog>';
  app.takeDialog = true;
  app.takefirstDayOfWeek = false;
  app.takeDisableDays = false;
  app.takeFormat = false;
  app.takeBindDate = false;
  app.takeFormatDate = false;
  app.takeModal = true;
  app.takeBackdrop = false;
  app.takeReset = false;
  app.takeElement = 'jv-datepicker-dialog';

  app.genCode = function(ev){
    var target = ev.target;

    if (!target.hasAttribute('data-toggle')) {
      return;
    }

    if (!app.dateCode) {
      return;
    }

    var toggleId = target.getAttribute('data-toggle'),
        toggleCheck = target.checked,
        newCodeStr = app.dateCode;
    switch (toggleId) {
      case 'dialog':
        app.takeElement = toggleCheck? 'jv-datepicker-dialog': 'jv-datepicker';
        if (!toggleCheck) {
          app.takeModal = app.takeBackdrop = !toggleCheck;
          newCodeStr = modifyCode(toggleCheck, newCodeStr, ' with-backdrop');
        }else {
          app.takeBackdrop = false;
        }
        newCodeStr = modifyCode(toggleCheck, newCodeStr, '', true);
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' modal');
        break;
      case 'start':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' first-day-of-week=""');
        break;
      case 'disable':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' disable-days=""');
        break;
      case 'format':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' format=""');
        break;
      case 'bind':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' bind-date=""');
        break;
      case 'fire':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' on-format-date=""');
        break;
      case 'modal':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' modal');
        break;
      case 'backdrop':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' with-backdrop');
        break;
      case 'reset':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' reset-date');
        break;
      default:
    }
    if(newCodeStr) {
      app.dateCode = newCodeStr;
    }
  };

  function modifyCode(toggle, str, insertion, tag) {
    var modifiedStr = '';
    if (toggle) {
      if (tag) {
        modifiedStr = str.replace(/(jv-datepicker)/gi, 'jv-datepicker-dialog');
      }else {
        var findAssertPoint = str.indexOf('>'),
            firstPartStr, lastParStr;
        firstPartStr = str.substring(0, findAssertPoint);
        lastParStr = str.substring(findAssertPoint);
        modifiedStr = firstPartStr.concat(insertion, lastParStr);
      }
    }else {
      if (tag) {
        modifiedStr = str.replace(/(jv-datepicker-dialog)/gi, 'jv-datepicker');
      }else {
        modifiedStr = str.replace(insertion, '');
      }
    }
    return modifiedStr;
  };

  function initializeDate(){
    var year = new Date().getFullYear(),
        month = new Date().getMonth() + 1,
        day = new Date().getDate();
    return year + '-' + ('00'+month).slice(-2) + '-' + day;
  };

  app._formatDate = function(ev, de, se) {
    app.displayDate = de.date;
  };

  app.checkboxHandler = function() {
    var disableArr = [],
    disableObj = {
      sun: this.sun,
      mon: this.mon,
      tue: this.tue,
      wed: this.wed,
      thu: this.thu,
      fri: this.fri,
      sat: this.sat
    };
    Object.keys(disableObj).forEach(function(el, idx) {
      if (disableObj[el]) {
        disableArr.push(idx);
      }
    });
    this.disableDays = disableArr;
  };

  document.addEventListener('selected-changed', function(ev) {
    var target = ev.target, targetId, targetValue;

    if (!target.hasAttribute('id')) {
      return;
    }

    targetId = target.getAttribute('id');
    targetValue = ev.detail.value;
    switch (targetId) {
      case 'start':
        var day = parseInt(targetValue);
        app.dayStart = app._dayStart(day);
        break;
      case 'year':
        app.dateFormat = app.dateFormat.replace(/^[y]+/gi, targetValue);
        break;
      case 'month':
        app.dateFormat = app.dateFormat.replace(/[m]+/gi, targetValue);
        break;
      case 'day':
        app.dateFormat = app.dateFormat.replace(/[d]+[o]*/gi, targetValue);
        break;
      default:
        console.log('Error');
    }
  }, true);

  app._dayStart = function(day) {
    switch (day) {
      case 0:
        return 'sunday';
        break;
      case 1:
        return 'monday';
        break;
      case 2:
        return 'tuesday';
        break;
      case 3:
        return 'wednesday';
        break;
      case 4:
        return 'thursday';
        break;
      case 5:
        return 'friday';
        break;
      case 6:
        return 'saturday';
        break;
      default:
        return 'sunday';
    }
  };

  app._openDatepicker = function(ev) {
    var button = ev.target;
    while (!button.hasAttribute('data-dialog') && button !== document.body) {
      button = button.parentElement;
    }
    if (!button.hasAttribute('data-dialog')) {
      return;
    }
    var id = button.getAttribute('data-dialog');
    var dialog = document.getElementById(id);
    if (dialog) {
      dialog.open();
    }
  }
</script>
</body>
</html>
