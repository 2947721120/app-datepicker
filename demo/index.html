<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>jv-datepicker demo</title>
  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../paper-styles/paper-styles.html">
  <link rel="import" href="../../paper-styles/demo-pages.html">
  <!-- <link rel="import" href="../../paper-radio-group/paper-radio-group.html">
  <link rel="import" href="../../paper-radio-button/paper-radio-button.html"> -->
  <link rel="import" href="../../paper-slider/paper-slider.html">
  <link rel="import" href="../../paper-button/paper-button.html">
  <link rel="import" href="../../paper-checkbox/paper-checkbox.html">
  <link rel="import" href="../../paper-toggle-button/paper-toggle-button.html">
  <link rel="import" href="../../neon-animation/animations/scale-up-animation.html">
  <link rel="import" href="../../neon-animation/animations/fade-out-animation.html">

  <link rel="import" href="../jv-datepicker-dialog.html">
  <style is="custom-style">
    :root {
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      box-sizing: border-box;
    }

    *, *::before, *::after {
      box-sizing: inherit;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
    }

    .horizontal-section {
      min-width: 130px;
    }

    .copy-attr {
       padding: 16px 0;
       @apply(--layout-horizontal);
       @apply(--layout-justified);
       @apply(--layout-flex-auto);
     }

     .copy-attr-span {
       padding: 8px 0;
     }

     .date-format-text {
       text-align: center;
       @apply(--layout-center-justified);
     }

    /*paper-button:hover {
      @apply(--shadow-elevation-3dp);
    }*/

    paper-button {
      display: block;
      margin-bottom: 24px;
    }

    paper-radio-button, paper-checkbox {
      display: block;
      width: 130px;
    }

    div paper-checkbox {
      margin-top: 12px;
      margin-bottom: 20px;
    }

    hr {
      margin-bottom: 40px;
      border-color: var(--divider-color, #e0e0e0);
    }

    .display-date {
      text-align: justify;
      padding-bottom: 20px;
    }

    .display-date > span {
      font-style: oblique;
      font-weight: bolder;
      color: var(--dark-primary-color, #303f9f);
    }

    .pick-date {
      margin: 20px 0;
    }

    .wrap-datepicker {
      overflow: auto;
      width: 96%;
      min-width: 300px;
      max-width: 96%;
    }

    .datepicker-boilerplate {
      width: 90%;
      border: 1px solid #cfd8dc;
      color: #607d8b;
      display: block;
      height: 36px;
      -webkit-flex-shrink: 0;
      flex-shrink: 0;
      padding: 10px 4px;
      margin: 0 13px 12px;
      -moz-box-sizing: border-box;
      box-sizing: border-box;
      border-radius: 2px;
      font-size: 12px;
    }

    .code-section div {
      margin: 20px 0;
    }

    .note {
      font-size: 10px;
      font-style: italic;
      color: #727272;
    }

    .normal {
      width: initial;
    }

    /* mixin */
    jv-datepicker-dialog#colorDialog {
      /*--jv-datepicker {}*/
      --jv-datepicker-button-color: #80CBC4;
      --jv-datepicker-button-ink-color: #80CBC4;
      --jv-datepicker-icon-button-color: #ffff00;
      --jv-datepicker-icon-button-ink-color: #ffff00;
      --jv-datepicker-selected-day-bg: #80CBC4;
      --jv-datepicker-selected-day-color: #555555;
      --jv-datepicker-today-color: #80CBC4;
      --jv-datepicker-disabled-color: #ffff00;
      --jv-datepicker-selection-color: #ffffff;
      --jv-datepicker-selection-bg: #555555;
      --jv-datepicker-weekday-bg: #555555;
      --jv-datepicker-bg: #424242;
      --jv-datepicker-calendar-text-color: #ffffff;
      --jv-datepicker-calendar-bg: #424242;
      --jv-datepicker-selection-ripple-color: #ffff00;
      --jv-datepicker-weekdays-color: #c6c6c6;
    }
  </style>
</head>
<body unresolved oncontextmenu="_disableRightClick(event)">
<template is="dom-bind" id="datepicker">
  <div class="horizontal-section-container">
    <div>
      <h4>Simple Styled</h4>
      <section class="horizontal-section">
        <paper-button tab-index="0" id="regular" data-dialog="regularDialog" on-tap="_openDatepicker">light theme</paper-button>
        <paper-button tab-index="0" id="color" data-dialog="colorDialog" on-tap="_openDatepicker">dark theme</paper-button>
        <paper-button tab-index="0" id="backdrop" data-dialog="backdropDialog" on-tap="_openDatepicker">with-backdrop</paper-button>
        <paper-button tab-index="0" id="simple" data-dialog="simpleDialog" on-tap="_openDatepicker">Simple</paper-button>
        <!-- <paper-button tab-index="0" id="reset" data-dialog="resetDialog" on-tap="_openDatepicker">reset date</paper-button></paper-button> -->
      </section>
    </div>

    <div on-change="_convertDayNumberToText">
      <h4>First Day of Week</h4>
      <section class="horizontal-section">
        <paper-slider data-slider="firstday" min="0" max="6" value="{{firstDayOfWeek}}" pin snaps></paper-slider>
        <paper-button tab-index="0" id="start" data-dialog="startDialog" on-tap="_openDatepicker">
          <span>{{firstDayOfWeek}} {{firstdayText}}</span>
        </paper-button>
      </section>
    </div>

    <div on-change="_convertNumberToArray">
      <h4>Disable Day (s)</h4>
      <section class="horizontal-section">
        <paper-checkbox data-box="sun" checked="{{sun}}">Sunday</paper-checkbox>
        <paper-checkbox data-box="mon" checked="{{mon}}">Monday</paper-checkbox>
        <paper-checkbox data-box="tue" checked="{{tue}}">Tuesday</paper-checkbox>
        <paper-checkbox data-box="wed" checked="{{wed}}">Wednesday</paper-checkbox>
        <paper-checkbox data-box="thu" checked="{{thu}}">Thursday</paper-checkbox>
        <paper-checkbox data-box="fri" checked="{{fri}}">Friday</paper-checkbox>
        <paper-checkbox data-box="sat" checked="{{sat}}">Saturday</paper-checkbox>
        <paper-button tab-index="0" id="multidays" data-dialog="disableDialog" on-tap="_openDatepicker">
          <span>disable days</span>
        </paper-button>
        <paper-button tab-index="0" id="weekends" data-dialog="weekendsDialog" on-tap="_openDatepicker">weekends</paper-button>
      </section>
    </div>

    <div>
      <h4>Date Format Options</h4>
        <section class="horizontal-section">
          <div on-change="_convertDateFormatNumberToText">
            <div class="copy-attr">
              <span class="copy-attr-span">Year</span>
              <paper-slider data-slider="yy" min="0" max="1" value="{{yy}}" pin snaps></paper-slider>
            </div>
            <div class="copy-attr">
              <span class="copy-attr-span">Month</span>
              <paper-slider data-slider="mm" min="0" max="3" value="{{mm}}" pin snaps></paper-slider>
            </div>
            <div class="copy-attr">
              <span class="copy-attr-span">Day</span>
              <paper-slider data-slider="dd" min="0" max="2" value="{{dd}}" pin snaps></paper-slider>
            </div>
            <div class="date-format-text copy-attr">{{dateFormatText}}</div>
            <div class="display-date">
              bind-date: <span>{{showBindDate}}</span>
            </div>
            <div class="display-date">
              fire-date: <span>{{showFireDate}}</span>
            </div>
            <paper-button tab-index="0" id="dayFormat" data-dialog="formatDialog" on-tap="_openDatepicker">
              <span>Choose a date</span>
            </paper-button>
          </div>
        </section>
      </div>
    </div>

    <div>
      <h4>Boilerplate Generator</h4>
      <section class="horizontal-section code-section" on-iron-change="genCode">
        <div class="copy-attr">
          <paper-checkbox data-date="withdialog" checked="{{withdialog}}" disabled="{{nodialog}}">jv-datepicker-dialog</paper-checkbox>
        </div>
        <div class="copy-attr">
          <paper-checkbox data-date="nodialog" checked="{{nodialog}}" disabled="{{withdialog}}">jv-datepicker</paper-checkbox>
        </div>
        <div class="copy-attr">
          <paper-checkbox data-toggle="modal" checked="{{modal}}" disabled="{{withdialog}}">modal</paper-checkbox>
        </div>
        <div class="copy-attr">
          <paper-checkbox data-toggle="backdrop" checked="{{backdrop}}" disabled="{{withdialog}}">withBackdrop</paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="start" checked="{{firstday}}">firstDayOfWeek</paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="disable" checked="{{disable}}">disableDays</paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="format" checked="{{format}}">dateFormat</paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="bind" checked="{{binddate}}">bindDate</paper-checkbox>
        </div>
        <div>
          <paper-checkbox data-toggle="fire" checked="{{formatdate}}">onFormatDate</paper-checkbox>
        </div>
        <div class="copy-section layout horizontal flex-auto">
          <input class="copy-me flex-auto" value="{{copyText}}" title="copy me" readonly onclick="this.select();">
        </div>
        <!-- <input class="datepicker-boilerplate" value="{{dateCode}}" title="jv-datepicker-boilerplate" readonly onclick="this.select();"> -->
      </section>
    </div>

    <div>
      <jv-datepicker-dialog id="regularDialog" entry-animation="scale-up-animation" modal  exit-animation="fade-out-animation"
      first-day-of-week="0" disable-days='"[0,6]"'></jv-datepicker-dialog>
      <jv-datepicker-dialog id="colorDialog" entry-animation="scale-up-animation" modal  exit-animation="fade-out-animation"
      first-day-of-week="0" disable-days='"[0,6]"'></jv-datepicker-dialog>
      <jv-datepicker-dialog id="backdropDialog" entry-animation="scale-up-animation" with-backdrop  exit-animation="fade-out-animation"
      first-day-of-week="0" disable-days='"[0,6]"'></jv-datepicker-dialog>
      <jv-datepicker-dialog id="simpleDialog" entry-animation="scale-up-animation"  exit-animation="fade-out-animation"
      first-day-of-week="0" disable-days='"[0,6]"'></jv-datepicker-dialog>
      <jv-datepicker-dialog id="startDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" modal
      first-day-of-week="{{firstDayOfWeek}}" disable-days='"[0,6]"'></jv-datepicker-dialog>
      <jv-datepicker-dialog id="disableDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" modal
      first-day-of-week="0" disable-days="{{disableDays}}"></jv-datepicker-dialog>
      <jv-datepicker-dialog id="weekendsDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" modal
      first-day-of-week="0" disable-days='"[0, 6]"'></jv-datepicker-dialog>
      <jv-datepicker-dialog id="formatDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" modal date-format="{{dateFormatText}}" bind-date="{{showBindDate}}" on-format-date="_formatDate"></jv-datepicker-dialog>
    </section>
  </div>
</template>
<script>
  var datepicker = document.querySelector('#datepicker');
  datepicker.disableDays = JSON.stringify([]);
  datepicker.dateFormatText = 'yyyy-mm-dd';
  datepicker.yy = 0;
  datepicker.mm = 2;
  datepicker.dd = 1;

  datepicker.firstDayOfWeek = 0;
  datepicker.firstdayText = 'Sunday';
  // datepicker.dateFormat = 'yyyy-mm-dd';
  // datepicker.dayStart = 'sunday';
  // datepicker.yearFormat = 'yyyy';
  // datepicker.monthFormat = 'mm';
  // datepicker.dayFormat = 'dd';
  // datepicker.displayDate = initializeDate();
  // datepicker.displayBind = initializeDate();

  datepicker.dateCode = '<jv-datepicker-dialog modal></jv-datepicker-dialog>';
  datepicker.takeDialog = true;
  datepicker.takefirstDayOfWeek = false;
  datepicker.takeDisableDays = false;
  datepicker.takeFormat = false;
  datepicker.takeBindDate = false;
  datepicker.takeFormatDate = false;
  datepicker.takeModal = true;
  datepicker.takeBackdrop = false;
  datepicker.takeReset = false;
  datepicker.takeElement = 'jv-datepicker-dialog';

  datepicker.genCode = function(ev){
    var target = ev.target;

    if (!target.hasAttribute('data-toggle')) {
      return;
    }

    if (!datepicker.dateCode) {
      return;
    }

    var toggleId = target.getAttribute('data-toggle'),
        toggleCheck = target.checked,
        newCodeStr = datepicker.dateCode;
    switch (toggleId) {
      case 'dialog':
        datepicker.takeElement = toggleCheck? 'jv-datepicker-dialog': 'jv-datepicker';
        if (!toggleCheck) {
          datepicker.takeModal = datepicker.takeBackdrop = !toggleCheck;
          newCodeStr = modifyCode(toggleCheck, newCodeStr, ' with-backdrop');
        }else {
          datepicker.takeBackdrop = false;
        }
        newCodeStr = modifyCode(toggleCheck, newCodeStr, '', true);
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' modal');
        break;
      case 'start':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' first-day-of-week=""');
        break;
      case 'disable':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' disable-days=""');
        break;
      case 'format':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' date-format=""');
        break;
      case 'bind':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' bind-date=""');
        break;
      case 'fire':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' on-format-date=""');
        break;
      case 'modal':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' modal');
        break;
      case 'backdrop':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' with-backdrop');
        break;
      case 'reset':
        newCodeStr = modifyCode(toggleCheck, newCodeStr, ' reset-date');
        break;
      default:
    }
    if(newCodeStr) {
      datepicker.dateCode = newCodeStr;
    }
  };

  function modifyCode(toggle, str, insertion, tag) {
    var modifiedStr = '';
    if (toggle) {
      if (tag) {
        modifiedStr = str.replace(/(jv-datepicker)/gi, 'jv-datepicker-dialog');
      }else {
        var findAssertPoint = str.indexOf('>'),
            firstPartStr, lastParStr;
        firstPartStr = str.substring(0, findAssertPoint);
        lastParStr = str.substring(findAssertPoint);
        modifiedStr = firstPartStr.concat(insertion, lastParStr);
      }
    }else {
      if (tag) {
        modifiedStr = str.replace(/(jv-datepicker-dialog)/gi, 'jv-datepicker');
      }else {
        modifiedStr = str.replace(insertion, '');
      }
    }
    return modifiedStr;
  };

  function initializeDate(){
    var year = new Date().getFullYear(),
        month = new Date().getMonth() + 1,
        day = new Date().getDate();
    return year + '-' + ('00'+month).slice(-2) + '-' + day;
  };

  datepicker.checkboxHandler = function() {
    var disableArr = [],
    disableObj = {
      sun: this.sun,
      mon: this.mon,
      tue: this.tue,
      wed: this.wed,
      thu: this.thu,
      fri: this.fri,
      sat: this.sat
    };
    Object.keys(disableObj).forEach(function(el, idx) {
      if (disableObj[el]) {
        disableArr.push(idx);
      }
    });
    this.disableDays = disableArr;
  };

  document.addEventListener('selected-changed', function(ev) {
    var target = ev.target, targetId, targetValue;

    if (!target.hasAttribute('id')) {
      return;
    }

    targetId = target.getAttribute('id');
    targetValue = ev.detail.value;
    switch (targetId) {
      case 'start':
        var day = parseInt(targetValue);
        datepicker.dayStart = datepicker._dayStart(day);
        break;
      case 'year':
        datepicker.dateFormatText = datepicker.dateFormat.replace(/^[y]+/gi, targetValue);
        break;
      case 'month':
        datepicker.dateFormat = datepicker.dateFormat.replace(/[m]+/gi, targetValue);
        break;
      case 'day':
        datepicker.dateFormat = datepicker.dateFormat.replace(/[d]+[o]*/gi, targetValue);
        break;
      default:
        console.log('Error');
    }
  }, true);

  //
  //
  //
  datepicker._openDatepicker = function(ev) {
    var button = ev.target;
    while (!button.hasAttribute('data-dialog') && button !== document.body) {
      button = button.parentElement;
    }
    if (!button.hasAttribute('data-dialog')) {
      return;
    }
    var id = button.getAttribute('data-dialog');
    var dialog = document.getElementById(id);
    if (dialog) {
      dialog.open();
    }
  };

  datepicker._convertDayNumberToText = function(ev) {
    var _target = ev.target,
        _weekdayText = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday','Saturday'];

    if (_target && _target.tagName === 'PAPER-SLIDER') {
      if (_target.hasAttribute('data-slider')) {
        if (_target.getAttribute('data-slider') === 'firstday') {
          datepicker.firstdayText = _weekdayText[_target.value];
        }
      }
    }
  };

  datepicker._convertNumberToArray = function(ev) {
    var _target = ev.target,
        _arr = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'],
        _box, _chk, _idx;

    if (_target && _target.tagName === 'PAPER-CHECKBOX') {
      if (_target.hasAttribute('data-box')) {
        _box = _target.getAttribute('data-box');
        _chk = _target.checked;
        datepicker.disableDays = _mutateDisableDays(_chk, _arr.indexOf(_box));
      }
      console.log(datepicker.disableDays);
    }
  };

  // mutate disableDays array.
  function _mutateDisableDays(_chk, _dayNumber) {
    // var _mutate = JSON.parse(datepicker.disableDays);
    var _mutate = JSON.parse(datepicker.disableDays);
    if (_chk) {
      _mutate.push(_dayNumber);
    }else {
      _mutate.splice(_mutate.indexOf(_dayNumber), 1);
    }
    console.log(_mutate);
    return JSON.stringify(_mutate);
  }

  datepicker._convertDateFormatNumberToText = function (ev) {
    var _target = ev.target,
        _yy = ['yyyy', 'yy'],
        _mm = ['mmmm', 'mmm', 'mm', 'm'],
        _dd = ['do', 'dd', 'd'],
        _slider, _val, _text;

    if (_target && _target.tagName === 'PAPER-SLIDER') {
      if (_target.hasAttribute('data-slider')) {
        _slider = _target.getAttribute('data-slider');
        _val = _target.value;

        switch (_slider) {
          case 'yy':
            _text = datepicker.dateFormatText.replace(/^[y]+/gi, _yy[_val]);
            break;
          case 'mm':
            _text = datepicker.dateFormatText.replace(/[m]+/gi, _mm[_val]);
            break;
          case 'dd':
            _text = datepicker.dateFormatText.replace(/[d]+[o]*/gi, _dd[_val]);
            break;
          default:
            console.log('Error');
        }
        datepicker.dateFormatText = _text;
      }
    }
  };

  datepicker._formatDate = function(ev, de, se) {
    datepicker.showFireDate = de.date;
  };

  // disable context menu on hold (right click on mobile).
  function _disableRightClick(ev) {
    ev.preventDefault();
    ev.stopPropagation();
    return false;
  }
</script>
</body>
</html>
